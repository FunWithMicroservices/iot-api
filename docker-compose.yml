version: "3"

volumes:
  python-consumer-log-volume:

services:
  fastapi:
    build: .
    container_name: workshop-iot-api-fastapi
    ports:
      - 8000:8000
    env_file: ./app/.env
    volumes:
      - ./app/:/app
      - python-consumer-log-volume:/app/logs/

  filebeat:
    image: "docker.elastic.co/beats/filebeat:8.1.1"
    container_name: workshop-iot-api-filebeat
    env_file: ./app/.env
    volumes:
      - ./elastic/filebeat.yml:/usr/share/filebeat/filebeat.yml:ro
      - /var/lib/docker:/var/lib/docker:ro
      - /var/run/docker.sock:/var/run/docker.sock
      - python-consumer-log-volume:/logs
